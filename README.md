Мы начинаем с 4 реплик, чтобы справиться с пиковой нагрузкой, как это показали нагрузочные тесты.
Используем readinessProbe и livenessProbe для проверки здоровья подов и обеспечения их готовности перед началом обслуживания трафика. Это особенно важно, учитывая 5-10 секунд на инициализацию приложения.
Задаем антиаффинити, чтобы поды не размещались на одной ноде, повышая отказоустойчивость.
Используем topologySpreadConstraints, чтобы равномерно распределить поды по зонам, что также увеличивает отказоустойчивость.
Настраиваем минимально доступное количество подов (3), чтобы при обновлениях и рестартах минимум 3 пода всегда оставались доступными.
HPA позволяет масштабировать количество подов в зависимости от загрузки CPU. Учитывая дневной цикл нагрузки, минимальное количество подов – 1, для ночного времени, и максимальное – 6, чтобы справиться с дневной пиковой нагрузкой.
